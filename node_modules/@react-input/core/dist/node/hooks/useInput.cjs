"use strict";var e=require("react"),t=require("react-dom"),n=require("../errors/SyntheticChangeError.cjs"),r=require("../utils/setInputAttributes.cjs");require("../_rollupPluginBabelHelpers-czPpl2Ww.js");var u=["text","email","tel","search","url"];module.exports=function(l){var i=l.init,o=l.tracking,a=l.eventType,c=l.eventHandler,d=e.useRef({timeoutId:-1,fallbackTimeoutId:-1,cachedTimeoutId:-1,start:0,end:0}),s=e.useRef(!0),v=e.useRef(null),p=e.useRef({init:i,tracking:o,eventType:a,eventHandler:c});return p.current.init=i,p.current.tracking=o,p.current.eventType=a,p.current.eventHandler=c,e.useMemo((function(){return function(e,t,n){var l=n.onFocus,i=n.onBlur,o=n.onInput;return new Proxy(e,{set:function(n,a,c){if("current"!==a)return!1;var d=null!==c&&u.includes(c.type);if("production"===process.env.NODE_ENV||null===c||d||console.warn("Warn: The input element type does not match one of the types: ".concat(u.join(", "),".")),c!==e.current&&(null!==e.current&&(e.current.removeEventListener("focus",l),e.current.removeEventListener("blur",i),e.current.removeEventListener("input",o)),null!==c&&d)){var s,v=null!==(s=c._wrapperState)&&void 0!==s?s:{},p=v.controlled,m=void 0!==p&&p,h=v.initialValue,f=void 0===h?"":h,b=t({controlled:m,initialValue:c.value||f});r(c,{value:b.value}),document.activeElement===c&&l(),c.addEventListener("focus",l),c.addEventListener("blur",i),c.addEventListener("input",o)}return n[a]=c,!0}})}(v,p.current.init,{onFocus:function(){d.current.timeoutId=window.setTimeout((function e(){var t,n,r,u;s.current?(d.current.start=null!==(t=null===(n=v.current)||void 0===n?void 0:n.selectionStart)&&void 0!==t?t:0,d.current.end=null!==(r=null===(u=v.current)||void 0===u?void 0:u.selectionEnd)&&void 0!==r?r:0,d.current.timeoutId=window.setTimeout(e)):d.current.fallbackTimeoutId=window.setTimeout(e)}))},onBlur:function(){window.clearTimeout(d.current.timeoutId),window.clearTimeout(d.current.fallbackTimeoutId),d.current.timeoutId=-1,d.current.fallbackTimeoutId=-1,d.current.cachedTimeoutId=-1},onInput:function(e){var u=v.current;if(null!==u)try{var l,i,o,a,c;if(d.current.cachedTimeoutId===d.current.timeoutId)throw new n("The input selection has not been updated.");d.current.cachedTimeoutId=d.current.timeoutId;var m=u.value,h=u.selectionStart,f=u.selectionEnd;if(null===h||null===f)throw new n("The selection attributes have not been initialized.");var b,E=null!==(l=null===(i=u._valueTracker)||void 0===i||null===(o=i.getValue)||void 0===o?void 0:o.call(i))&&void 0!==l?l:"";if(void 0===e.inputType&&(d.current.start=0,d.current.end=E.length),h>d.current.start?b="insert":h<=d.current.start&&h<d.current.end?b="deleteBackward":h===d.current.end&&m.length<E.length&&(b="deleteForward"),void 0===b||("deleteBackward"===b||"deleteForward"===b)&&m.length>E.length)throw new n("Input type detection error.");var w="",T="",_=d.current.start,g=d.current.end;if("insert"===b)w=m.slice(d.current.start,h);else{var I=E.length-m.length;_=h,g=h+I,T=E.slice(_,g)}var S=p.current.tracking({inputType:b,previousValue:E,value:m,addedValue:w,deletedValue:T,changeStart:_,changeEnd:g,selectionStart:h,selectionEnd:f});r(u,{value:S.value,selectionStart:S.selectionStart,selectionEnd:S.selectionEnd});var y=p.current.eventType,k=p.current.eventHandler;if("string"==typeof y&&k){var V=u.value,q=u.selectionStart,L=u.selectionEnd;s.current=!1,requestAnimationFrame((function(){r(u,{value:V,selectionStart:null!=q?q:V.length,selectionEnd:null!=L?L:V.length});var e=new CustomEvent(y,{bubbles:!0,cancelable:!1,composed:!0,detail:S.__detail});u.dispatchEvent(e),t.unstable_batchedUpdates?t.unstable_batchedUpdates(k,e):k(e),s.current=!0}))}null===(a=u._valueTracker)||void 0===a||null===(c=a.setValue)||void 0===c||c.call(a,E),d.current.start=S.selectionStart,d.current.end=S.selectionEnd}catch(t){var B,F,H,j,R,x,C,P,A,D,N,U=t,z=U.name,M=U.cause;if(r(u,{value:null!==(B=null!==(F=null==M||null===(H=M.__attributes)||void 0===H?void 0:H.value)&&void 0!==F?F:null===(j=u._valueTracker)||void 0===j||null===(R=j.getValue)||void 0===R?void 0:R.call(j))&&void 0!==B?B:"",selectionStart:null!==(x=null==M||null===(C=M.__attributes)||void 0===C?void 0:C.selectionStart)&&void 0!==x?x:d.current.start,selectionEnd:null!==(P=null==M||null===(A=M.__attributes)||void 0===A?void 0:A.selectionEnd)&&void 0!==P?P:d.current.end}),void 0!==(null==M||null===(D=M.__attributes)||void 0===D?void 0:D.selectionStart)&&(d.current.start=M.__attributes.selectionStart),void 0!==(null==M||null===(N=M.__attributes)||void 0===N?void 0:N.selectionEnd)&&(d.current.end=M.__attributes.selectionEnd),e.preventDefault(),e.stopPropagation(),"SyntheticChangeError"!==z)throw t}}})}),[])};
